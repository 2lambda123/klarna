@model EPiServer.Reference.Commerce.Site.Features.Payment.PaymentMethods.KlarnaPaymentsPaymentMethod

@Html.HiddenFor(model => model.SystemKeyword)

@if (!string.IsNullOrWhiteSpace(Model.KlarnaLogoUrl))
{
    <img src="@Model.KlarnaLogoUrl" alt="Klarna logo" class="klarna-logo" />
}

<div class="row">
    <div class="col-xs-12">
        @{ var first = false; }
        @foreach (var category in Model.PaymentMethodCategories)
        {
            <div class="radio">
                <label>
                    <input type="radio" name="klarna-payments-select" data-klarna-payments-select="@category.Identifier" @(first ? "checked" : string.Empty) />
                    <img src="@category.AssetUrls.Standard" alt="@category.Name" class="klarna-logo" />
                    @category.Name
                </label>
            </div>
            first = false;
        }
    </div>
</div>

<div id="klarna_container"></div>
<div id="klarna_container_error" class="alert alert-danger" hidden>@Html.Translate("/Checkout/Payment/Errors/NotAvailable")</div>

<script>
    (function () {
        var klarnaData = {
            klarna_container: "#klarna_container",
            client_token: '@Model.ClientToken'
        };

        // Register callback function to be executed after initial load
        window.klarnaAsyncCallback = function () {
            KlarnaPayments.load(klarnaData);
        };

        // Only call this if jQuery/Klarna/KlarnaPayments has been loaded already
        if (window.jQuery && window.Klarna && window.KlarnaPayments) {
            window.setTimeout(function () {
                KlarnaPayments.load(klarnaData);
            }, 100);
        }
    })();
</script>